const BASE_URL = "http://localhost:8080/api/history";

// ğŸ” Autentificare Basic
const username = "admin";
const password = "ek1111";
const basicAuth = "Basic " + btoa(`${username}:${password}`);

// FuncÈ›ie universalÄƒ de request cu autentificare È™i gestionare erori
async function request(url, options = {}) {
  const response = await fetch(url, {
    ...options,
    headers: {
      Authorization: basicAuth,
      "Content-Type": "application/json",
      ...(options.headers || {}),
    },
  });

  if (!response.ok) {
    const errorText = await response.text();
    console.error("âŒ Eroare:", errorText);
    throw new Error(`Eroare (${response.status}): ${errorText}`);
  }

  const contentType = response.headers.get("Content-Type");
  if (contentType && contentType.includes("application/json")) {
    return await response.json();
  } else {
    return null;
  }
}

// ğŸ”¸ Trimite istoricul bugetar pentru o lunÄƒ (POST)
export function saveHistory(data) {
  console.log("ğŸ“¤ SalvÄƒm istoric:", data);
  return request(BASE_URL, {
    method: "POST",
    body: JSON.stringify(data),
  });
}

// ğŸ”¹ ObÈ›ine istoricul pentru o lunÄƒ (GET)
export function getHistoryByMonth(month) {
  console.log("ğŸ“¥ Cerem istoricul pentru luna:", month);
  return request(`${BASE_URL}?month=${month}`);
}
